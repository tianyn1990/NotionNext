#!/bin/bash

################################################################################
# NotionNext 部署脚本快速参考
# 使用: ./help.sh
################################################################################

cat << 'EOF'
╔═══════════════════════════════════════════════════════════════╗
║          NotionNext 自动化部署 - 快速参考                     ║
╚═══════════════════════════════════════════════════════════════╝

📦 部署流程
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  本地构建   │────▶│  Git推送    │────▶│  ECS部署    │
│  AMD64镜像  │     │  代码+镜像  │     │  拉取+启动  │
└─────────────┘     └─────────────┘     └─────────────┘

🚀 一键部署（推荐）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  在本地Mac执行：
  $ ./quick-deploy.sh

  自动完成：构建 → 推送 → SSH部署

📋 分步操作
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  步骤1 - 本地构建并推送：
  $ ./build-and-push.sh

  步骤2 - SSH到ECS执行部署：
  $ ssh root@你的ECS-IP
  $ cd /root/github-repo/NotionNext
  $ ./deploy.sh

🛠️  常用命令
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  查看服务状态：
  $ docker compose ps

  查看实时日志：
  $ docker compose logs -f notionnext

  重启服务：
  $ docker compose restart

  停止服务：
  $ docker compose stop

  启动服务：
  $ docker compose start

  完全停止并删除：
  $ docker compose down

🔍 故障排查
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  查看详细日志：
  $ docker compose logs notionnext | tail -100

  查看容器状态：
  $ docker ps -a | grep notionnext

  查看镜像列表：
  $ docker images | grep notionnext

  进入容器调试：
  $ docker exec -it notionnext sh

  测试HTTP访问：
  $ curl -I http://localhost:3000

🔄 版本回滚
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  查看提交历史：
  $ git log --oneline

  回滚到指定版本：
  $ git reset --hard <commit-id>

  重新部署：
  $ ./deploy.sh -y

⚙️  配置文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  .env                    环境变量配置（不提交Git）
  blog.config.js          NotionNext站点配置
  docker-compose.yml      Docker服务配置
  Dockerfile              镜像构建定义

🌐 访问地址
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  本地访问：http://localhost:3000
  外网访问：http://你的ECS-IP:3000

📚 详细文档
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  查看完整说明：
  $ cat README-DEPLOY.md

  查看完整部署指南：
  $ cat NotionNext-阿里云ECS-Docker部署完整指南.md

💡 提示
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  • 首次使用前需配置 quick-deploy.sh 中的ECS信息
  • 确保ECS上 .env 文件已正确配置 NOTION_PAGE_ID
  • 配置SSH密钥登录可提升部署效率
  • 镜像文件约300-500MB，首次推送需要时间

EOF
